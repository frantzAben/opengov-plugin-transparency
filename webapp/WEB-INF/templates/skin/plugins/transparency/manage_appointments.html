<@row>
	<@columns>
		<div class="container">
			<@messages infos=infos />
			<h2 class="heading-title">#i18n{transparency.manage_appointments.title}</h4>
		</div>
	</@columns>
</@row>
<@row>
	<@columns>
		<div class="container">
                    
                    <form class="form-inline" action="jsp/site/Portal.jsp?page=meeting" method="post" name="form_search_appointment" role="form">

			<@messages errors=errors />
                        
                        <div class="form-group">
                                <label class="control-label" for="search_title">
                                    #i18n{transparency.manage_appointments.searchByTitleLabel}
                                </label>
                                <div>
                                    <input class="form-control " id="search_title" name="search_title" type="text" value="" />
                                </div>
                        </div>
                        <div class="form-group">
                                <label class="control-label" for="search_period">
                                    #i18n{transparency.manage_appointments.searchByPeriodLabel}
                                </label>
                                <div>
                                <select id="search_period" name="search_period" class="form-control ">
					<option value="-1">#i18n{transparency.manage_appointments.search_since_default}</option>
					<option value="7" >#i18n{transparency.manage_appointments.search_since_last_week}</option>
					<option value="31">#i18n{transparency.manage_appointments.search_since_last_month}</option>
					<option value="92" selected=selected>#i18n{transparency.manage_appointments.search_since_last_3_months}</option>
				</select>
                                </div>
                        </div>
                        <div class="form-group">
                                <label class="control-label" for="search_elected_official">
                                    #i18n{transparency.manage_appointments.searchByElectedOfficialNameLabel}
                                </label>
                                <div>
                                    <input class="form-control" id="search_elected_official" name="search_elected_official" type="text" value="" />
                                </div>
                        </div>
                        <div class="form-group">
                                <label class="control-label" for="search_lobby">
                                    #i18n{transparency.manage_appointments.searchByLobbyNameLabel}
                                </label>
                                <div>
                                    <input class="form-control" id="search_lobby" name="search_lobby" type="text" value="" />
                                </div>
                        </div>
                        <div class="form-group">
                            
                        <button class="btn btn-sm btn-primary btn-flat btn-transparencysearch" type="submit" title="Rechercher" name="action_searchAppointment">
                            <i class="fa fa-search" aria-hidden="true"></i>
                            #i18n{portal.site.page_menu_tools.labelSearch}
                        </button>
                               
			<#if is_authenticated  = false >
                            <a href="jsp/site/Portal.jsp?page=mylutece" class="btn btn-primary btn-sm btn-transparencysearch">Authentification</a>
			</#if>
                        </div>
		</form>
		<#if is_authenticated  = true>
			<@tform action='jsp/site/Portal.jsp?page=meeting'>
				<@button type='submit' name='view_createAppointment' class='pull-right' buttonIcon='plus' title='#i18n{transparency.manage_appointments.buttonAdd}' />
			</@tform>
		</#if>
		</div>
	</@columns>
</@row>
<@row params='style="margin-top:50px;"'>
	<@columns>
		<div class="container">
			<div class="directory-result-list">
				<table class="table table-striped">
					<tr>
						<th class="col-xs-1 col-sm-2">#i18n{transparency.manage_appointments.columnTitle}</th>
						<th class="col-xs-1 col-sm-2">#i18n{transparency.manage_appointments.columnStartDate}
                                                    <@sort jsp_url="jsp/site/Portal.jsp?page=meeting" attribute="start_date" />
                                                </th>
						<th class="col-xs-1 col-sm-2">#i18n{transparency.manage_appointments.columnElectedOfficials}</th>
						<th class="col-xs-1 col-sm-2">#i18n{transparency.manage_appointments.columnLobbies}</th>
						<th class="col-xs-1 col-sm-2">#i18n{transparency.manage_appointments.columnContacts}</th>
						<#if is_authenticated = true >
						<th class="col-xs-1 col-sm-1">#i18n{portal.util.labelActions}</th>
						</#if>
					</tr>
					<#list appointment_list as appointment>
					<tr>
						<td>
							<p>
								<a href='jsp/site/Portal.jsp?page=meeting&view=detailAppointment&id=${appointment.id}' title='#i18n{transparency.detail_appointment.title}'>
									${appointment.title}
								</a>
							</p>
							<!-- <p>${appointment.description}</p> -->
						</td>    
						<td>${appointment.startDate}</td>    
						<td>
						<#list appointment.electedOfficialList as electedOfficial>
							${electedOfficial.lastName}<br>
						</#list>
						</td>    
						<td>
						<#list appointment.lobbyList as lobby>
							<p>
								<a href='jsp/site/Portal.jsp?page=lobby&view=detailLobby&id=${lobby.id}' title='#i18n{transparency.detail_lobby.title}' >
									${lobby.name} 
								</a>
							</p>
						</#list>
						</td>    
						<td>
							${appointment.contacts!''}
						</td>   
						<#if is_authenticated  = true > 
						<td>
							<@aButton href='jsp/site/Portal.jsp?page=meeting&view=modifyAppointment&id=${appointment.id}' title='#i18n{portal.util.labelModify}' showTitle=false buttonIcon='pencil-square-o' size='xs' />
							<@aButton href='jsp/site/Portal.jsp?page=meeting&action=confirmRemoveAppointment&id=${appointment.id}' title='#i18n{portal.util.labelDelete}' buttonIcon='trash' showTitle=false color='btn-danger' size='xs' />
						</td>
						</#if>
					</tr>
					</#list>
				</table>
			</div>
		</div>
	</@columns>
</@row>

<script src="js/jquery/jquery-ui.min.js"></script>  

<script  type="text/javascript" >
  $( function() {

    var getData = function (request, response) {
        $.getJSON(
            "${base_url}rest/transparency/api/v1/lobbies/search=" + request.term,
            function (data) {
                response(data);
            }
        );
    };

    $( "#search_lobby" ).autocomplete({
      source: getData,
      minLength: 3
    });
  } );
</script>
  